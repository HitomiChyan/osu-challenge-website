<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æŒ‘æˆ°çµæœæŸ¥è©¢</title>
  <link rel="stylesheet" href="/styles/style.css" />
  <link rel="stylesheet" href="/styles/admin-custom.css" />
</head>
<body>
  <h1>æŒ‘æˆ°çµæœæŸ¥è©¢</h1>

  <!-- æ–°åŠŸèƒ½æŒ‰éˆ• -->
  <div class="button-container" style="text-align:center; margin-bottom: 24px;">
    <button onclick="location.href='/index.html'">ğŸ  æ´»å‹•é¦–é </button>
    <button onclick="location.href='/signup.html'">ğŸ“‹ æ´»å‹•è¦å‰‡</button>
    <button onclick="location.href='/register.html'">âœï¸ æˆ‘è¦å ±å</button>              
    <button onclick="location.href='/tickets.html'">ğŸ† çå‹µæŸ¥è©¢</button>          
  </div>

  <div class="search-container">
    <label>æœå°‹ Twitch IDï¼š<input type="text" id="search-box" /></label>
  </div>
  <table id="tbl-results">
    <thead>
      <tr>
        <th>Twitch ä¸­æ–‡åç¨±</th>
        <th>Twitch ID</th>
        <th>æ´»å‹•åç¨±</th>
        <th>æŒ‘æˆ° Rank</th>
        <th>æŒ‘æˆ°æ™‚é–“</th>
        <th>çµæœ1</th>
        <th>çµæœ2</th>
        <th>çµæœ3</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="status-msg" style="text-align:center;color:#c00;margin-top:24px;"></p>
  <script>
    const API_BASE = location.origin;
    const searchBox = document.getElementById('search-box');
    const tblResults = document.querySelector('#tbl-results tbody');
    const statusMsg = document.getElementById('status-msg');
    let allRegistrations = [];

    async function fetchData() {
      try {
        statusMsg.textContent = '';
        const regsRes = await fetch(`${API_BASE}/api/registrations`, { credentials: 'include' });
        if (!regsRes.ok) throw new Error('å¾Œå°é€£ç·šå¤±æ•—æˆ–æœªç™»å…¥');
        allRegistrations = await regsRes.json();
        renderTable();
      } catch (e) {
        statusMsg.textContent = e.message || 'è³‡æ–™è¼‰å…¥å¤±æ•—';
      }
    }

    function renderTable() {
      const keyword = searchBox.value.trim().toLowerCase();
      tblResults.innerHTML = '';
      allRegistrations
        .filter(item => item.identity === 'æŒ‘æˆ°è€…')
        .filter(item =>
          !keyword || (item.twitchID && item.twitchID.toLowerCase().includes(keyword))
        )
        .forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.twitchName || ''}</td>
            <td>${item.twitchID || ''}</td>
            <td>${item.activityName || ''}</td>
            <td>${item.rank || ''}</td>
            <td>${item.time || ''}</td>
            <td>${item.results?.[0] || ''}</td>
            <td>${item.results?.[1] || ''}</td>
            <td>${item.results?.[2] || ''}</td>
          `;
          tblResults.appendChild(tr);
        });
      if (tblResults.innerHTML === '') {
        tblResults.innerHTML = `<tr><td colspan="8" style="color:#888;">æŸ¥ç„¡è³‡æ–™</td></tr>`;
      }
    }
    searchBox.addEventListener('input', renderTable);

    window.addEventListener('DOMContentLoaded', fetchData);
  </script>
</body>
</html>
