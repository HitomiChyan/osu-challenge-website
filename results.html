<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>挑戰結果查詢</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="stylesheet" href="styles/admin-custom.css" />
</head>
<body>
  <h1>挑戰結果查詢</h1>

  <!-- 新功能按鈕 -->
  <div class="button-container" style="text-align:center; margin-bottom: 24px;">
    <button onclick="location.href='index.html'">🏠 活動首頁</button>
    <button onclick="location.href='signup.html'">📋 活動規則</button>
    <button onclick="location.href='register.html'">✏️ 我要報名</button>              
    <button onclick="location.href='tickets.html'">🏆 獎勵查詢</button>          
  </div>

  <div class="search-container">
    <label>搜尋 Twitch ID：<input type="text" id="search-box" /></label>
  </div>
  <table id="tbl-results">
    <thead>
      <tr>
        <th>Twitch 中文名稱</th>
        <th>Twitch ID</th>
        <th>活動名稱</th>
        <th>挑戰 Rank</th>
        <th>挑戰時間</th>
        <th>結果1</th>
        <th>結果2</th>
        <th>結果3</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="status-msg" style="text-align:center;color:#c00;margin-top:24px;"></p>
  <script>
    const searchBox = document.getElementById('search-box');
    const tblResults = document.querySelector('#tbl-results tbody');

    async function fetchData() {
      try {
        statusMsg.textContent = '';
        const regsRes = await fetch('data/registrations.json');
        if (!regsRes.ok) throw new Error('資料載入失敗');
        allRegistrations = await regsRes.json();
        renderTable();
      } catch (e) {
        statusMsg.textContent = e.message || '資料載入失敗';
    // 靜態資料，可由 Google Sheet 匯出後更新
    const allRegistrations = [
      {
        twitchName: '示例一',
        twitchID: 'example1',
        activityName: '活動 A',
        rank: 'S',
        time: '01:23',
        results: ['100%', '95%', '90%']
      },
      {
        twitchName: '示例二',
        twitchID: 'example2',
        activityName: '活動 B',
        rank: 'A',
        time: '02:10',
        results: ['92%', '88%', '85%']
      }
    ];

    function renderTable() {
      const keyword = searchBox.value.trim().toLowerCase();
      tblResults.innerHTML = '';
      const rows = allRegistrations
        .filter(item => item.identity === '挑戰者')
        .filter(
          item =>
            !keyword || (item.twitchID && item.twitchID.toLowerCase().includes(keyword))
        );

      rows.forEach(item => {
        const tr = document.createElement('tr');
        const cells = [
          item.twitchName || '',
          item.twitchID || '',
          item.activityName || '',
          item.rank || '',
          item.time || '',
          item.results?.[0] || '',
          item.results?.[1] || '',
          item.results?.[2] || ''
        ];
        cells.forEach(text => {
          const td = document.createElement('td');
          td.textContent = text;
          tr.appendChild(td);
      allRegistrations
        .filter(item =>
          !keyword || (item.twitchID && item.twitchID.toLowerCase().includes(keyword))
        )
        .forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.twitchName || ''}</td>
            <td>${item.twitchID || ''}</td>
            <td>${item.activityName || ''}</td>
            <td>${item.rank || ''}</td>
            <td>${item.time || ''}</td>
            <td>${item.results?.[0] || ''}</td>
            <td>${item.results?.[1] || ''}</td>
            <td>${item.results?.[2] || ''}</td>
          `;
          tblResults.appendChild(tr);
        });
        tblResults.appendChild(tr);
      });

      if (!tblResults.childElementCount) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 8;
        td.textContent = '查無資料';
        td.style.color = '#888';
        tr.appendChild(td);
        tblResults.appendChild(tr);
      }
    }
    searchBox.addEventListener('input', renderTable);
    window.addEventListener('DOMContentLoaded', renderTable);
  </script>
</body>
</html>
