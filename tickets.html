<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æŠ½çåˆ¸æ•¸é‡æŸ¥è©¢</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="stylesheet" href="styles/admin-custom.css" />
</head>
<body>
  <h1>æŠ½çåˆ¸æ•¸é‡æŸ¥è©¢</h1>

  <!-- ğŸŒŸ æ–°åŠŸèƒ½æŒ‰éˆ• -->
  <div class="button-container" style="text-align:center; margin-bottom: 24px;">
    <button onclick="location.href='index.html'">ğŸ  æ´»å‹•é¦–é </button>
    <button onclick="location.href='signup.html'">ğŸ“‹ æ´»å‹•è¦å‰‡</button>
    <button onclick="location.href='register.html'">âœï¸ æˆ‘è¦å ±å</button>
    <button onclick="location.href='results.html'">ğŸ“Š æŒ‘æˆ°çµæœ</button>                  
  </div>

  <!-- ğŸ” æœå°‹ Twitch ID -->
  <div class="search-container">
    <label>æœå°‹ Twitch IDï¼š<input type="text" id="search-box" /></label>
  </div>

  <!-- ğŸ“‹ æŠ½çåˆ¸æ•¸æ“šè¡¨ -->
  <table id="tbl-tickets">
    <thead>
      <tr>
        <th>Twitch ä¸­æ–‡åç¨±</th>
        <th>Twitch ID</th>
        <th>æ´»å‹•åç¨±</th>
        <th>èº«åˆ†</th>
        <th>ç¸½è¨ˆæŠ½çåˆ¸</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="status-msg" style="text-align:center;color:#c00;margin-top:24px;"></p>

  <script>
    const API_BASE = location.origin;
    const searchBox = document.getElementById('search-box');
    const tblTickets = document.querySelector('#tbl-tickets tbody');
    const statusMsg = document.getElementById('status-msg');
    let allTickets = [];

            // ğŸŒŸ æ•´ç†æŒ‘æˆ°è€…èˆ‡éæŒ‘æˆ°è€…è³‡æ–™
        const regsRows = regs
          .filter(x => (x.totalTickets || 0) > 0)
          .map(x => ({
            twitchName: x.twitchName || '',
            twitchID: x.twitchID || '',
            activityName: x.activityName || '',
            identity: x.identity || 'æŒ‘æˆ°è€…',
            totalTickets: x.totalTickets || 0
          }));

        const ncsRows = ncs
          .filter(x => (x.totalTickets || 0) > 0)
          .map(x => ({
            twitchName: x.twitchName || '',
            twitchID: x.twitchID || '',
            activityName: x.activityName || '',
            identity: 'éæŒ‘æˆ°è€…',
            totalTickets: x.totalTickets || 0
          }));

        // ğŸ”¥ åˆä½µæ‰€æœ‰è³‡æ–™
        allTickets = [...regsRows, ...ncsRows];
        renderTickets();
      } catch (e) {
        statusMsg.textContent = e.message || 'è³‡æ–™è¼‰å…¥å¤±æ•—';
      }
    }

    function renderTickets() {
      const keyword = searchBox.value.trim().toLowerCase();
      tblTickets.innerHTML = '';
      allTickets
        .filter(item => !keyword || (item.twitchID && item.twitchID.toLowerCase().includes(keyword)))
        .forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.twitchName}</td>
            <td>${item.twitchID}</td>
            <td>${item.activityName}</td>
            <td>${item.identity}</td>
            <td>${item.totalTickets}</td>
          `;
          tblTickets.appendChild(tr);
        });

      if (tblTickets.innerHTML === '') {
        tblTickets.innerHTML = `<tr><td colspan="5" style="color:#888;">æŸ¥ç„¡è³‡æ–™</td></tr>`;
      }
    }

    searchBox.addEventListener('input', renderTickets);
    window.addEventListener('DOMContentLoaded', fetchTickets);
  </script>
</body>
</html>
